<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Philosophy Resurrected — Official Site</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header" role="banner">
        <div class="brand">
            <h1>Philosophy <span>Resurrected</span></h1>
        </div>
        <nav class="nav" role="navigation" aria-label="Main Navigation">
            <a href="#spotlight">Spotlight</a>
            <a href="#albums">Albums</a>
            <a href="#gallery">Gallery</a>
            <a href="#videos">Videos</a>
        </nav>
    </header>

    <section class="hero" aria-label="Site Introduction">
        <div class="hero-title">Welcome to Philosophy Resurrected</div>
        <div class="hero-desc">
            Where sound becomes reflection. Inspired by Plato’s idea that artists reshape the world through imitation, this is a space to explore original albums, videos, and visual art. "Artists are imitators of imitators!" - Plato
        </div>
        <a href="#albums"><button class="cta-btn" aria-label="Browse Albums">Browse Albums</button></a>
    </section>

    <section id="spotlight" class="section-block" aria-labelledby="spotlight-title" style="display:none;">
        <h2 class="section-title" id="spotlight-title">Spotlight Video</h2>
        <div id="spotlightContainer" class="video-grid"></div>
    </section>

    <section id="albums" class="section-block" aria-labelledby="albums-title">
        <h2 class="section-title" id="albums-title">Albums</h2>
        <div id="albumContainer" class="album-grid"></div>
    </section>

    <section id="gallery" class="section-block" aria-labelledby="gallery-title">
        <h2 class="section-title" id="gallery-title">Image Gallery</h2>
        <div id="imageGallery" class="image-grid"></div>
    </section>

    <section id="videos" class="section-block" aria-labelledby="videos-title">
        <h2 class="section-title" id="videos-title">Music Videos</h2>
        <div id="videoContainer" class="video-grid"></div>
    </section>

    <footer class="footer" role="contentinfo">
        <p>© 2025 Philosophy Resurrected — All Rights Reserved</p>
    </footer>

    <div id="imgModal" style="display:none; position:fixed; left:0; top:0; right:0; bottom:0; background:rgba(24,26,32,0.85); z-index:9999; align-items:center; justify-content:center;">
        <img id="imgModalImg" src="" alt="Full Image" style="max-width:90vw; max-height:90vh; border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.18);">
    </div>

    <script>
        function setupSinglePlayback() {
            function pauseOthers(e) {
                const target = e.target;
                const allMedia = document.querySelectorAll('audio,video');
                allMedia.forEach(el => {
                    if (el !== target) el.pause();
                });
            }
            document.querySelectorAll('audio,video').forEach(el => {
                el.removeEventListener('play', pauseOthers); 
                el.addEventListener('play', pauseOthers);
            });
        }

        async function loadData() {
            try {
                const homeRes = await fetch('/api/homepage');
                const homeData = await homeRes.json();
                const albumRes = await fetch('/api/albums');
                const albums = await albumRes.json();
                const videoRes = await fetch('/api/videos');
                const videos = await videoRes.json();
                const mediaRes = await fetch('/api/media');
                let images = [];
                if (mediaRes.ok) {
                    const mediaData = await mediaRes.json();
                    images = mediaData.filter(m => m.kind === 'image');
                }
                loadSpotlight(homeData, videos);
                loadAlbums(albums);
                loadImages(images);
                loadVideos(videos);
                setTimeout(setupSinglePlayback, 100);
            } catch (e) {
                console.error("Failed to load homepage data:", e);
            }
        }

        function loadSpotlight(layoutBlocks, videos) {
            const section = document.getElementById('spotlight');
            const container = document.getElementById('spotlightContainer');
            if (!section || !container) return;
            const featured = layoutBlocks.find(block => block.type === 'featured_video' && block.reference_id);
            if (!featured) {
                section.style.display = "none";
                container.innerHTML = "";
                return;
            }
            const video = videos.find(v => String(v.id) === String(featured.reference_id));
            if (!video) {
                section.style.display = "none";
                container.innerHTML = "";
                return;
            }
            container.innerHTML = `
                <div class="video-card spotlight-video-card">
                    <video controls poster="${video.thumbnail}" controlsList="nodownload noplaybackrate" oncontextmenu="return false;" style="width:100%;max-width:1000px;aspect-ratio:16/9;display:block;margin:auto;">
                        <source src="${video.path}" type="video/mp4">
                    </video>
                    <h3 style="font-size:2rem;margin-top:1rem;">${video.title}</h3>
                    <p style="font-size:1.15rem;">${video.description || ""}</p>
                </div>
            `;
            section.style.display = "block";
            setTimeout(setupSinglePlayback, 50);
        }

        function loadImages(images) {
            const gallery = document.getElementById('imageGallery');
            gallery.innerHTML = "";
            images.forEach(img => {
                const el = document.createElement('img');
                el.src = img.path;
                el.classList.add('gallery-img');
                el.style.cursor = "pointer";
                el.onclick = () => showImgModal(img.path);
                gallery.appendChild(el);
            });
        }
        function showImgModal(src) {
            const modal = document.getElementById('imgModal');
            const modalImg = document.getElementById('imgModalImg');
            modalImg.src = src;
            modal.style.display = "flex";
        }
        document.getElementById('imgModal').onclick = function() {
            this.style.display = "none";
            document.getElementById('imgModalImg').src = "";
        };

        function loadAlbums(albums) {
            const container = document.getElementById('albumContainer');
            container.innerHTML = "";
            albums.forEach(album => {
                const div = document.createElement('div');
                div.classList.add('album-card');
                div.innerHTML = `
                    <img src="${album.image}" class="album-cover" alt="album cover">
                    <h3>${album.title}</h3>
                    <p>${album.description || ""}</p>
                `;
                const list = document.createElement('ul');
                list.classList.add('track-list');
                album.tracks.forEach(t => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${t.track_number}. ${t.title}</span>
                        <audio controls preload="metadata" controlsList="nodownload noplaybackrate" oncontextmenu="return false;">
                            <source src="${t.path}" type="audio/mpeg">
                        </audio>
                    `;
                    list.appendChild(li);
                });
                div.appendChild(list);
                container.appendChild(div);
            });
            setTimeout(setupSinglePlayback, 50);
        }
        function loadVideos(videos) {
            const container = document.getElementById('videoContainer');
            container.innerHTML = "";
            videos.forEach(video => {
                const card = document.createElement('div');
                card.classList.add('video-card');
                card.innerHTML = `
                    <video controls poster="${video.thumbnail}" controlsList="nodownload noplaybackrate" oncontextmenu="return false;">
                        <source src="${video.path}" type="video/mp4">
                    </video>
                    <h3>${video.title}</h3>
                    <p>${video.description || ""}</p>
                `;
                container.appendChild(card);
            });
            setTimeout(setupSinglePlayback, 50);
        }
        loadData();
        document.addEventListener('contextmenu', (e) => {
            if (e.target.tagName === 'VIDEO' || e.target.tagName === 'AUDIO') e.preventDefault();
        });
    </script>
    <style>
        .spotlight-video-card {
            max-width: 1000px;
            margin: 0 auto 2rem auto;
            padding: 0 1rem;
        }
        @media (max-width: 1200px) {
            .spotlight-video-card {
                max-width: 90vw;
            }
        }
        @media (max-width: 800px) {
            .spotlight-video-card video {
                max-width: 100vw;
            }
            .spotlight-video-card h3 {
                font-size: 1.3rem;
            }
        }
    </style>
</body>
</html>
